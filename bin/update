#!/bin/sh

# A super generic update script to update my system in one go.

# TODO:
#   * dont just update and upgrade packages, remove/purge packages not
#     used by the system anymore (for ubuntu)
#   * Make gentoo part smarted (use return codes)
#   * git update should be much smarter.

# repo list
GIT_DOTS="git -C $HOME"
GIT_PASS="git -C $HOME/.password-store"
GIT_PUBS="git -C $HOME/.pubs"
GIT_BOOK="git -C $HOME/lib/bookmarks"

# Update system packages
if [ -n "$(uname -v | grep -i "UBUNTU")" ]; then
    echo "sudo apt-get update && sudo apt-get upgrade"
    sudo apt-get update && sudo apt-get upgrade
else
    echo "sudo emerge --sync && sudo emerge -DuvaN --with-bdeps=y @world"
    sudo emerge --sync && sudo emerge -DuvaN --with-bdeps=y @world && \
        sudo emerge --ask --depclean && sudo revdep-rebuild
fi

# Git updater
git_update() {
    GIT="$@"
    DIR="$3"
    echo -e "\nUpdated git repo in $DIR"
    $GIT pull
}

# Start ssh-agent so we don't have to type passphrase multiple times
eval `ssh-agent -s`
ssh-add ~/.ssh/id_rsa

# Update my git repositories
git_update $GIT_DOTS
git_update $GIT_PASS
git_update $GIT_PUBS
git_update $GIT_BOOK

# Kill ssh-agent
pkill ssh-agent
