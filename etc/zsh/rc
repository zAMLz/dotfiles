#!/bin/zsh

# This is just to make sure everything is sourced properly
source /etc/profile

# History
export HISTSIZE=2000
export HISTFILE="$HOME/.zhistory"
export SAVEHIST=$HISTSIZE

# Various Settings
setopt hist_ignore_all_dups
setopt hist_ignore_space
setopt autocd
unsetopt BEEP # turn of audible beeps

# setopt extendedglob
bindkey -v

# Shell Completions
fpath=($HOME/etc/zsh/completions $fpath)
autoload -U compinit
compinit

# Shell Correction
# setopt correctall

# Shell Prompt
autoload -U promptinit
promptinit

# Source the important stuff
source $HOME/etc/zsh/aliases
source $HOME/etc/zsh/functions

# Thanks to this wonderful command in ZSH prompt is always regenerated
# after every command!
precmd() {
    export PS1=$(ps1_generate)
}

# Update our ls colors
eval $(dircolors -b $HOME/lib/shell/lscolors)

# Update the path variable
export PATH="$HOME/lib/private/bin:$PATH"
export PATH="$HOME/.local/bin/:$PATH"
export PATH="$HOME/bin:$PATH"

# Necessary exports
export GPG_TTY=$(tty)
export PINENTRY_USER_DATA='tty'
export DISTRO=$(grep --color=none ^ID= /etc/os-release | tr '=' ' ' | \
        tr -d '"' | awk '{print $2}')

# Export to configure certain apps
export HTOPRC="$HOME/etc/htop/rc"
export TASKRC="$HOME/etc/taskwarrior/rc"
export PASSWORD_STORE_DIR="$HOME/usr/passwords"
export LEDGER_FILE="$HOME/usr/ledger/main.journal"

# Source some special programs
source $HOME/sys/path.sh 2> /dev/null

# Finally, if we are ina virtual environment start it
if [ -n "$VIRTUAL_ENV" ]; then
    source ${VIRTUAL_ENV}/bin/activate
fi
